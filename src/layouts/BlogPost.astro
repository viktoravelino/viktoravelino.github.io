---
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import { formatDate } from "../lib/utils";
import Layout from "./Layout.astro";

interface Props {
  title: string;
  description: string;
  date: Date;
  tags?: string[];
  coverImage?: string;
}

const { title, description, date, tags, coverImage } = Astro.props;

const formattedDate = formatDate(date);
const canonicalUrl = new URL(Astro.url.pathname, Astro.site ?? Astro.url.origin).href;

const blogPostingSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: title,
  description,
  datePublished: date.toISOString(),
  author: {
    "@type": "Person",
    name: "Viktor Avelino",
    url: "https://viktoravelino.com",
  },
  publisher: {
    "@type": "Person",
    name: "Viktor Avelino",
    url: "https://viktoravelino.com",
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": canonicalUrl,
  },
  ...(coverImage && {
    image: new URL(coverImage, "https://viktoravelino.com").href,
  }),
};
---

<Layout title={`${title} | Viktor Avelino`} description={description} ogImage={coverImage} ogType="article" publishedDate={date}>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(blogPostingSchema)} />
  </Fragment>
  <Header />
  <main class="max-w-3xl mx-auto px-6 pt-32 pb-20">
    <a
      href="/blog"
      class="inline-flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors mb-8"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m15 18-6-6 6-6"></path>
      </svg>
      Back to blog
    </a>

    <article>
      {
        coverImage && (
          <img
            src={coverImage}
            alt={title}
            width={960}
            height={540}
            loading="eager"
            class="w-full rounded-lg mb-10"
          />
        )
      }
      <header class="mb-10">
        <time datetime={date.toISOString()} class="text-sm text-muted-foreground">
          {formattedDate}
        </time>
        <h1 class="text-4xl font-bold mt-2 mb-4">{title}</h1>
        {
          tags && tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {tags.map((tag) => (
                <span class="text-xs px-2.5 py-1 rounded-full bg-secondary text-secondary-foreground">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

       <!-- <div
        class="prose prose-neutral dark:prose-invert max-w-none
        [&>h2]:text-2xl [&>h2]:font-semibold [&>h2]:mt-10 [&>h2]:mb-4
        [&>h3]:text-xl [&>h3]:font-semibold [&>h3]:mt-8 [&>h3]:mb-3
        [&>p]:text-foreground/80 [&>p]:leading-7 [&>p]:mb-4
        [&>ul]:list-disc [&>ul]:pl-6 [&>ul]:mb-4 [&>ul>li]:mb-1
        [&>ol]:list-decimal [&>ol]:pl-6 [&>ol]:mb-4 [&>ol>li]:mb-1
        [&>pre]:bg-secondary [&>pre]:p-4 [&>pre]:rounded-lg [&>pre]:overflow-x-auto [&>pre]:mb-4
        [&>code]:bg-secondary [&>code]:px-1.5 [&>code]:py-0.5 [&>code]:rounded [&>code]:text-sm
        [&>blockquote]:border-l-4 [&>blockquote]:border-border [&>blockquote]:pl-4 [&>blockquote]:italic [&>blockquote]:text-muted-foreground
        [&>a]:text-primary [&>a]:underline [&>a]:underline-offset-4 hover:[&>a]:text-primary/80"
      > -->
      <div class="prose prose-neutral dark:prose-invert max-w-none">
        <slot />
      </div>
    </article>
  </main>
  <Footer />
</Layout>
